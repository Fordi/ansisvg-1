<svg viewBox="0 0 {{mul $.TerminalWidth .CharacterBoxSize.Width}} {{mul .Lines .CharacterBoxSize.Height}}" xmlns="http://www.w3.org/2000/svg">
    <style>
        svg {
            background-color: {{index $.BackgroundColors 0}}
        }
        rect {
            width: {{$.CharacterBoxSize.Width}}px;
            height: {{$.CharacterBoxSize.Height}}px;
            shape-rendering: crispedges;
        }
        text {
            dominant-baseline: hanging;
            white-space: pre;{{/* draw underline even when whitespace */}}
            font: {{$.FontSize}}px {{$.Font}};
            fill: {{index $.ForegroundColors 0}};
        }
        .u { text-decoration: underline; }
        .i { filter: brightness(1.5) saturate(150%); }
{{- range $i, $c := $.ForegroundColors}}
{{- if ne $c ""}}
        .f{{$i}} { fill: {{$c}}; }
{{- end}}
{{- end}}
{{- range $i, $c := $.BackgroundColors}}
{{- if ne $c ""}}
        .b{{$i}} { fill: {{$c}}; }
{{- end}}
{{- end}}
    </style>

{{- range $i, $c := .Chars}}
{{- if le $c.X $.TerminalWidth}}
    {{- if hasprefix $c.Background "#"}}
    <rect x="{{mul $c.X $.CharacterBox.Width}}" y="{{mul $c.Y $.CharacterBoxSize.Height}}" style="fill: {{$c.Background}}"></rect>
    {{- else if ne $c.Background "0"}}
    <rect x="{{mul $c.X $.CharacterBoxSize.Width}}" y="{{mul $c.Y $.CharacterBoxSize.Height}}" class="b{{$c.Background}}"></rect>
    {{- end}}
{{- if or $c.Underline (not (iswhitespace $c.Char))}}
    {{- if hasprefix $c.Foreground "#"}}
    <text x="{{mul $c.X $.CharacterBoxSize.Width}}" y="{{mul $c.Y $.CharacterBoxSize.Height}}" style="fill: {{$c.Foreground}}" class="{{if $c.Underline}}u{{end}} {{if $c.Intensity}}i{{end}}">{{$c.Char}}</text>
    {{- else if or (ne $c.Foreground "0") $c.Underline $c.Intensity}}
    <text x="{{mul $c.X $.CharacterBoxSize.Width}}" y="{{mul $c.Y $.CharacterBoxSize.Height}}" class="f{{$c.Foreground}} {{if $c.Underline}}u{{end}} {{if $c.Intensity}}i{{end}}">{{$c.Char}}</text>
    {{- else}}
    <text x="{{mul $c.X $.CharacterBoxSize.Width}}" y="{{mul $c.Y $.CharacterBoxSize.Height}}">{{$c.Char}}</text>
    {{- end}}
{{- end}}
{{- end}}
{{- end}}
</svg>
